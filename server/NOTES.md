 
# LIAN SERVERLESS DOC

Это файлик с обяснениями по серверу приложения

### serverless + aws lambda

Серверлес позволяет сконфигурировать раные ключи и функции залития на прод намного проще чем может быть с другими приложениями а так же сам процес залития будет быстрее
Но самое главное здесь это aws-lambda при использовании этой технологии каждый ендпоит выступает в роли отдельного приложения
Самый главный вывод тут что ООП не подходит для такого приложения так как для каждого запуска надо создавать обект класса, или использовать статические классы которые не надо обьявлять для каждого ендпроита
Именно так тут и работает на примере файло "*.service.ts" или "*.dao.ts"

### *.handler.ts
Файл заключает в себе начало входа в приложение
Он описан для обьявлении в приложении в ближайщем "*.yml" файле
Там описывается его название какой метод выхова используется и его путь
Так же там можно описать дополнительные проверки перед запуском middlware

Пример:
```
createProduct:
  handler: src/server/product/handler/product.create.handler.productCreateHandler
  events:
    - http:
        path: product
        method: post
```

Так же перед запуском сервиса запускается валидания которая проверяет данные которые нужны для запроса
что бы удостовериться что данные которые нам нужны точно пришли
подробнее про валидацию дальше

### *.service.ts

файлы с основной логикой подключает бд к и делает запросы в бд
принеобходимости запускает бд *транзакции  

так же там заключается логика взаимодействий между файлами

*бд транзакции не сохраняют данные если на каком то из этапов блока произошло ошибка
помогает избежать не правильного сохранения или не полного сохранения данных при запросе

### *.dao.ts
файлы работы с базой данных

каждая функция выполняет только одну функцию
то есть в функции только 1 формат запроса select|update|insert|delete

при необходимости можно делать сложные запросы


### knex

в продолжение работы с бд

бибоиотека для запросов Knex
она расчитана только как помощник для запросов одна из самых маленьких и легких библиотек без большого количества зависимостей от других библиотек

так же она отвичает за создание и изменение миграций и сидов для бд

(миграция -> файл изменения бд в котором прописываються изменения вперед и назад необходимо для обратной совместимости системы,
приписывается создание таблицы изменение полей или проверок бд)


(сид -> файлы для внесения данных в бд, к примеру какие то данные которые нужны по умолчанию при установке и запуске приложения что бы не вностить все данные для тестирования ручками каждый раз)

### Валидация | JOI

Файлы валидации из себя представляют обьекты в которые прописывается какие поля с каким типом должны или могут прийти.
Так же при необходимости устанавливание длина минимальное максимальное значение или зависимость на остальные поля

Пример

```
const schema = Joi.object({
  title: Joi.string().alphanum().min(3).max(100), // Проверяет что это строчка только из букв минимально 3 символов максимально 100 символов, поле опциональное
  description: Joi.string().alphanum().min(3),
  minCost: Joi.number().min(0).default(0),
  maxCost: Joi.number().positive().greater(Joi.ref('minCost')), // проверяет что это положительное число(>0) и что больше minCost
  minCount: Joi.number().min(0),
  maxCount: Joi.number().positive().greater(Joi.ref('minCount')),
  limit: Joi.number().positive(),
  offset: Joi.number().min(0),
  asc: Joi.boolean().default(true),
  sortField: Joi.string().default('title').valid('title', 'description', 'cost', 'count'), // проверяет что это строчка по умолчанию ставит значение если ничего не пришло и проверяет на то что значение только одно из заданных значений
})

```

### *.input.ts || *.dto.ts

интерфейсы для описание типов либо которые мы ожидаем на ввод или получить из бд

### коневые файлы

#### .env
файл подкачки секретных ключей которые нельзя хранить в гите
пароли доступы акаунтов и т д

ипользовать из можно с библиотекой dotenv достать с помощью команды proccess.env.KEY_NAME

#### .env.example
хранит в себе обычно только ключи кторые ипользуються
ну или значения для локального запуска

#### .eslintrc.js
проверка стиля кода
настраиеват стиль кода выдает ошибки в зависимости от рулов выставленных в настройках

#### .prettierrc
проверка стиля кода
отступы, длина строчки, точки с запятой 

#### knexfile
файл концигурации для библиотеки knex если быть точнее для запуска миграций и сидов 
основаная концигурация подключения находиться в файле src/server/db/knexConfig.ts

#### serverless.yml
файл запуска приложения
в него записываються то какие плагины для данной библиотеки используються 
так же если нужны глобальные переменные для aws сервера то тоже тут прописываются
сюда необходимо записывать все функции что используються либо испортировать файлы с функциями 

#### tsconfig.json 

файл компиляции

#### package.json
данные по проекту
название автор
настройки гит команд
список команд для использование
библиотеки которые били использованны

Последовательность запуска приложенияЖ

поднятие докера запуск бд сервера в нем
```
  "compose:up": "docker-compose -f docker/docker-compose.services.yml up -d",
```

запуск миграций которые добавят таблицы в бд
```
 "migrate": "knex migrate:latest",
```
запуск сидов при необходимости
```
 "migrate:seed": "knex seed:run",
```

запуск сервера
```
 "start:server": "serverless offline",
```

описание остальных команд

```
    "lint": "eslint \"./src/**/*.ts\"",  // проверка кода по стилю
    "lint:fix": "eslint \"./src/**/*.ts\" --fix",  // проверка кода по стилю и исправление там где это возможно автоматически
    "compose:down": "docker-compose -f docker/docker-compose.services.yml down", // удаление Бд сервера в докере
    "migrate:create": "knex migrate:make Initial -x ts" // временная команда для создания файла миграции, при добавлении изменить Initial на необходимое
```
